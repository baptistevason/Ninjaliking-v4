<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” Analyse ComplÃ¨te</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .status { padding: 15px; margin: 15px 0; border-radius: 5px; font-weight: bold; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .critical { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; border-left: 5px solid #dc3545; }
        button { background: #007bff; color: white; border: none; padding: 15px 30px; border-radius: 5px; cursor: pointer; margin: 10px; font-size: 16px; }
        button:hover { background: #0056b3; }
        button.success { background: #28a745; }
        button.success:hover { background: #218838; }
        button.danger { background: #dc3545; }
        button.danger:hover { background: #c82333; }
        .data-item { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 3px; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; font-size: 12px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .critical-section { border-left: 5px solid #dc3545; background: #f8d7da; }
        .important-section { border-left: 5px solid #ffc107; background: #fff3cd; }
        .analysis-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
        .analysis-card { background: #f8f9fa; padding: 15px; border-radius: 5px; border: 1px solid #dee2e6; }
        .analysis-card h4 { margin-top: 0; color: #495057; }
        .metric { display: flex; justify-content: space-between; margin: 5px 0; }
        .metric-value { font-weight: bold; }
        .metric-good { color: #28a745; }
        .metric-warning { color: #ffc107; }
        .metric-error { color: #dc3545; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Analyse ComplÃ¨te de l'Application</h1>
        
        <div id="status" class="status info">
            Diagnostic complet en cours...
        </div>
        
        <div class="test-section critical-section">
            <h3>ğŸš¨ ProblÃ¨mes Critiques</h3>
            <button onclick="analyzeCriticalIssues()" class="danger">ğŸ” Analyser ProblÃ¨mes Critiques</button>
            <div id="critical-results"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“Š Analyse des Composants</h3>
            <div class="analysis-grid">
                <div class="analysis-card">
                    <h4>ğŸ—ï¸ Structure DOM</h4>
                    <button onclick="analyzeDOMStructure()">ğŸ” Analyser DOM</button>
                    <div id="dom-analysis"></div>
                </div>
                <div class="analysis-card">
                    <h4>ğŸ”§ Scripts JavaScript</h4>
                    <button onclick="analyzeJavaScript()">ğŸ” Analyser JS</button>
                    <div id="js-analysis"></div>
                </div>
                <div class="analysis-card">
                    <h4>ğŸ” Authentification</h4>
                    <button onclick="analyzeAuthentication()">ğŸ” Analyser Auth</button>
                    <div id="auth-analysis"></div>
                </div>
                <div class="analysis-card">
                    <h4>ğŸ’¾ DonnÃ©es</h4>
                    <button onclick="analyzeData()">ğŸ” Analyser DonnÃ©es</button>
                    <div id="data-analysis"></div>
                </div>
            </div>
        </div>
        
        <div class="test-section important-section">
            <h3>ğŸ”§ Tests de FonctionnalitÃ©s</h3>
            <button onclick="testCoreFunctionality()" class="success">ğŸ§ª Tester FonctionnalitÃ©s</button>
            <button onclick="testNavigation()">ğŸ§ª Tester Navigation</button>
            <button onclick="testAuthentication()">ğŸ§ª Tester Auth</button>
            <div id="functionality-results"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“‹ Rapport Complet</h3>
            <button onclick="generateCompleteReport()" class="success">ğŸ“‹ GÃ©nÃ©rer Rapport</button>
            <button onclick="exportAnalysis()">ğŸ“¤ Exporter Analyse</button>
            <div id="report-results"></div>
        </div>
        
        <div id="results" style="margin-top: 20px;"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
        }
        
        function addResult(containerId, message) {
            const container = document.getElementById(containerId);
            const item = document.createElement('div');
            item.className = 'data-item';
            item.innerHTML = message;
            container.appendChild(item);
        }
        
        function analyzeCriticalIssues() {
            log('ğŸš¨ Analyse des problÃ¨mes critiques...', 'error');
            
            addResult('critical-results', '<h4>ğŸš¨ ProblÃ¨mes Critiques IdentifiÃ©s:</h4>');
            
            const criticalIssues = [];
            
            // 1. VÃ©rifier les erreurs de console
            addResult('critical-results', '<h5>1. Erreurs de Console:</h5>');
            addResult('critical-results', 'VÃ©rifiez la console du navigateur pour les erreurs JavaScript');
            
            // 2. VÃ©rifier les scripts manquants
            addResult('critical-results', '<h5>2. Scripts JavaScript:</h5>');
            const requiredScripts = ['ninja-linking-script.js', 'supabase-service.js'];
            requiredScripts.forEach(script => {
                const scriptElement = document.querySelector(`script[src*="${script}"]`);
                if (scriptElement) {
                    addResult('critical-results', `âœ… ${script} chargÃ©`);
                } else {
                    addResult('critical-results', `âŒ ${script} manquant`);
                    criticalIssues.push(`Script manquant: ${script}`);
                }
            });
            
            // 3. VÃ©rifier les Ã©lÃ©ments DOM critiques
            addResult('critical-results', '<h5>3. Ã‰lÃ©ments DOM Critiques:</h5>');
            const criticalElements = [
                'homepage-container',
                'auth-container', 
                'main-interface',
                'projects-page',
                'catalog-page'
            ];
            
            criticalElements.forEach(elementId => {
                const element = document.getElementById(elementId);
                if (element) {
                    addResult('critical-results', `âœ… ${elementId} trouvÃ©`);
                } else {
                    addResult('critical-results', `âŒ ${elementId} manquant`);
                    criticalIssues.push(`Ã‰lÃ©ment DOM manquant: ${elementId}`);
                }
            });
            
            // 4. VÃ©rifier les fonctions critiques
            addResult('critical-results', '<h5>4. Fonctions Critiques:</h5>');
            const criticalFunctions = [
                'initializeApp',
                'setupAuthEventListeners',
                'switchPage',
                'loadData',
                'renderProjects'
            ];
            
            criticalFunctions.forEach(func => {
                if (typeof window[func] === 'function') {
                    addResult('critical-results', `âœ… ${func} disponible`);
                } else {
                    addResult('critical-results', `âŒ ${func} manquante`);
                    criticalIssues.push(`Fonction manquante: ${func}`);
                }
            });
            
            // 5. RÃ©sumÃ© des problÃ¨mes critiques
            if (criticalIssues.length > 0) {
                addResult('critical-results', '<h5>ğŸš¨ ProblÃ¨mes Critiques DÃ©tectÃ©s:</h5>');
                criticalIssues.forEach(issue => {
                    addResult('critical-results', `âŒ ${issue}`);
                });
                log(`âŒ ${criticalIssues.length} problÃ¨mes critiques dÃ©tectÃ©s`, 'error');
            } else {
                addResult('critical-results', 'âœ… Aucun problÃ¨me critique dÃ©tectÃ©');
                log('âœ… Aucun problÃ¨me critique', 'success');
            }
        }
        
        function analyzeDOMStructure() {
            log('ğŸ—ï¸ Analyse de la structure DOM...', 'info');
            
            addResult('dom-analysis', '<h4>ğŸ—ï¸ Structure DOM:</h4>');
            
            // 1. VÃ©rifier les conteneurs principaux
            const mainContainers = [
                'homepage-container',
                'auth-container',
                'main-interface',
                'app'
            ];
            
            mainContainers.forEach(container => {
                const element = document.getElementById(container);
                if (element) {
                    const isVisible = element.style.display !== 'none';
                    addResult('dom-analysis', `${container}: ${isVisible ? 'Visible' : 'CachÃ©'}`);
                } else {
                    addResult('dom-analysis', `${container}: âŒ Manquant`);
                }
            });
            
            // 2. VÃ©rifier les pages
            const pages = [
                'ninjalinking-page',
                'projects-page',
                'catalog-page',
                'serp-page',
                'ereputation-page',
                'ia-page'
            ];
            
            addResult('dom-analysis', '<h5>ğŸ“„ Pages:</h5>');
            pages.forEach(page => {
                const element = document.getElementById(page);
                if (element) {
                    const isActive = element.classList.contains('active');
                    addResult('dom-analysis', `${page}: ${isActive ? 'Active' : 'Inactive'}`);
                } else {
                    addResult('dom-analysis', `${page}: âŒ Manquant`);
                }
            });
            
            // 3. VÃ©rifier les boutons de navigation
            const navButtons = document.querySelectorAll('.nav-btn');
            addResult('dom-analysis', `<h5>ğŸ”˜ Boutons de Navigation: ${navButtons.length}</h5>`);
            
            navButtons.forEach((btn, index) => {
                const page = btn.dataset.page;
                const isActive = btn.classList.contains('active');
                addResult('dom-analysis', `Bouton ${index + 1}: ${page} (${isActive ? 'Active' : 'Inactive'})`);
            });
            
            log('âœ… Analyse DOM terminÃ©e', 'success');
        }
        
        function analyzeJavaScript() {
            log('ğŸ”§ Analyse des scripts JavaScript...', 'info');
            
            addResult('js-analysis', '<h4>ğŸ”§ Scripts JavaScript:</h4>');
            
            // 1. VÃ©rifier les scripts chargÃ©s
            const scripts = document.querySelectorAll('script[src]');
            addResult('js-analysis', `<h5>ğŸ“œ Scripts ChargÃ©s: ${scripts.length}</h5>`);
            
            scripts.forEach((script, index) => {
                const src = script.src;
                const isLoaded = script.readyState === 'complete' || script.readyState === 'loaded';
                addResult('js-analysis', `Script ${index + 1}: ${src} (${isLoaded ? 'ChargÃ©' : 'En cours'})`);
            });
            
            // 2. VÃ©rifier les variables globales
            addResult('js-analysis', '<h5>ğŸŒ Variables Globales:</h5>');
            const globalVars = [
                'isAuthenticated',
                'currentUser',
                'db',
                'isSupabaseConfigured',
                'projects',
                'sites'
            ];
            
            globalVars.forEach(varName => {
                const exists = typeof window[varName] !== 'undefined';
                const value = window[varName];
                addResult('js-analysis', `${varName}: ${exists ? (value || 'DÃ©fini') : 'Non dÃ©fini'}`);
            });
            
            // 3. VÃ©rifier les fonctions principales
            addResult('js-analysis', '<h5>ğŸ”§ Fonctions Principales:</h5>');
            const mainFunctions = [
                'initializeApp',
                'setupAuthEventListeners',
                'switchPage',
                'loadData',
                'renderProjects',
                'renderSites',
                'checkAuthentication',
                'showMainInterface',
                'showHomepage'
            ];
            
            mainFunctions.forEach(func => {
                const exists = typeof window[func] === 'function';
                addResult('js-analysis', `${func}: ${exists ? 'âœ…' : 'âŒ'}`);
            });
            
            log('âœ… Analyse JavaScript terminÃ©e', 'success');
        }
        
        function analyzeAuthentication() {
            log('ğŸ” Analyse de l\'authentification...', 'info');
            
            addResult('auth-analysis', '<h4>ğŸ” Authentification:</h4>');
            
            // 1. VÃ©rifier l'Ã©tat d'authentification
            addResult('auth-analysis', '<h5>ğŸ”‘ Ã‰tat d\'Authentification:</h5>');
            const isAuth = window.isAuthenticated;
            const currentUser = window.currentUser;
            const localStorageAuth = localStorage.getItem('isAuthenticated');
            const localStorageUser = localStorage.getItem('currentUser');
            
            addResult('auth-analysis', `isAuthenticated: ${isAuth || 'false'}`);
            addResult('auth-analysis', `currentUser: ${currentUser || 'null'}`);
            addResult('auth-analysis', `localStorage isAuthenticated: ${localStorageAuth || 'Non dÃ©fini'}`);
            addResult('auth-analysis', `localStorage currentUser: ${localStorageUser ? 'DÃ©fini' : 'Non dÃ©fini'}`);
            
            // 2. VÃ©rifier la configuration Supabase
            addResult('auth-analysis', '<h5>ğŸ”§ Configuration Supabase:</h5>');
            const supabaseUrl = localStorage.getItem('supabase-url');
            const supabaseKey = localStorage.getItem('supabase-anon-key');
            const isSupabaseConfigured = window.isSupabaseConfigured;
            
            addResult('auth-analysis', `URL Supabase: ${supabaseUrl || 'Non configurÃ©'}`);
            addResult('auth-analysis', `ClÃ© Supabase: ${supabaseKey ? 'ConfigurÃ©e' : 'Non configurÃ©e'}`);
            addResult('auth-analysis', `isSupabaseConfigured: ${isSupabaseConfigured || 'false'}`);
            
            // 3. VÃ©rifier les fonctions d'authentification
            addResult('auth-analysis', '<h5>ğŸ”§ Fonctions d\'Auth:</h5>');
            const authFunctions = [
                'checkAuthentication',
                'loginUser',
                'registerUser',
                'showLoginForm',
                'showRegisterForm',
                'showMainInterface',
                'showHomepage'
            ];
            
            authFunctions.forEach(func => {
                const exists = typeof window[func] === 'function';
                addResult('auth-analysis', `${func}: ${exists ? 'âœ…' : 'âŒ'}`);
            });
            
            log('âœ… Analyse authentification terminÃ©e', 'success');
        }
        
        function analyzeData() {
            log('ğŸ’¾ Analyse des donnÃ©es...', 'info');
            
            addResult('data-analysis', '<h4>ğŸ’¾ DonnÃ©es:</h4>');
            
            // 1. VÃ©rifier les donnÃ©es en mÃ©moire
            addResult('data-analysis', '<h5>ğŸ§  DonnÃ©es en MÃ©moire:</h5>');
            const projects = window.projects || [];
            const sites = window.sites || [];
            
            addResult('data-analysis', `Projets: ${projects.length}`);
            addResult('data-analysis', `Sites: ${sites.length}`);
            
            // 2. VÃ©rifier localStorage
            addResult('data-analysis', '<h5>ğŸ’¾ localStorage:</h5>');
            const dataItems = [
                'ninjalinking-projects',
                'ninjalinking-sites',
                'isAuthenticated',
                'currentUser',
                'supabase-url',
                'supabase-anon-key'
            ];
            
            dataItems.forEach(item => {
                const value = localStorage.getItem(item);
                addResult('data-analysis', `${item}: ${value ? 'DÃ©fini' : 'Non dÃ©fini'}`);
            });
            
            // 3. VÃ©rifier les fonctions de donnÃ©es
            addResult('data-analysis', '<h5>ğŸ”§ Fonctions de DonnÃ©es:</h5>');
            const dataFunctions = [
                'loadData',
                'saveData',
                'renderProjects',
                'renderSites',
                'updateProjectStats'
            ];
            
            dataFunctions.forEach(func => {
                const exists = typeof window[func] === 'function';
                addResult('data-analysis', `${func}: ${exists ? 'âœ…' : 'âŒ'}`);
            });
            
            log('âœ… Analyse donnÃ©es terminÃ©e', 'success');
        }
        
        function testCoreFunctionality() {
            log('ğŸ§ª Test des fonctionnalitÃ©s de base...', 'info');
            
            addResult('functionality-results', '<h4>ğŸ§ª Tests de FonctionnalitÃ©s:</h4>');
            
            // 1. Test de l'initialisation
            addResult('functionality-results', '<h5>1. Test d\'Initialisation:</h5>');
            if (typeof initializeApp === 'function') {
                try {
                    initializeApp();
                    addResult('functionality-results', 'âœ… Initialisation rÃ©ussie');
                } catch (error) {
                    addResult('functionality-results', `âŒ Erreur initialisation: ${error.message}`);
                }
            } else {
                addResult('functionality-results', 'âŒ Fonction initializeApp non trouvÃ©e');
            }
            
            // 2. Test de la navigation
            addResult('functionality-results', '<h5>2. Test de Navigation:</h5>');
            if (typeof switchPage === 'function') {
                try {
                    switchPage('ninjalinking');
                    addResult('functionality-results', 'âœ… Navigation rÃ©ussie');
                } catch (error) {
                    addResult('functionality-results', `âŒ Erreur navigation: ${error.message}`);
                }
            } else {
                addResult('functionality-results', 'âŒ Fonction switchPage non trouvÃ©e');
            }
            
            // 3. Test du chargement des donnÃ©es
            addResult('functionality-results', '<h5>3. Test de Chargement:</h5>');
            if (typeof loadData === 'function') {
                try {
                    loadData();
                    addResult('functionality-results', 'âœ… Chargement des donnÃ©es rÃ©ussi');
                } catch (error) {
                    addResult('functionality-results', `âŒ Erreur chargement: ${error.message}`);
                }
            } else {
                addResult('functionality-results', 'âŒ Fonction loadData non trouvÃ©e');
            }
            
            log('âœ… Tests de fonctionnalitÃ©s terminÃ©s', 'success');
        }
        
        function testNavigation() {
            log('ğŸ§ª Test de navigation...', 'info');
            
            addResult('functionality-results', '<h4>ğŸ§ª Test de Navigation:</h4>');
            
            // Tester les boutons de navigation
            const navButtons = document.querySelectorAll('.nav-btn');
            addResult('functionality-results', `Boutons de navigation trouvÃ©s: ${navButtons.length}`);
            
            navButtons.forEach((btn, index) => {
                const page = btn.dataset.page;
                const hasClickListener = btn.onclick !== null;
                const hasEventListener = btn.addEventListener !== undefined;
                
                addResult('functionality-results', `Bouton ${index + 1} (${page}): onclick=${hasClickListener ? 'âœ…' : 'âŒ'}, addEventListener=${hasEventListener ? 'âœ…' : 'âŒ'}`);
            });
            
            // Tester la fonction switchPage
            if (typeof switchPage === 'function') {
                addResult('functionality-results', 'âœ… Fonction switchPage disponible');
            } else {
                addResult('functionality-results', 'âŒ Fonction switchPage non disponible');
            }
            
            log('âœ… Test navigation terminÃ©', 'success');
        }
        
        function testAuthentication() {
            log('ğŸ§ª Test d\'authentification...', 'info');
            
            addResult('functionality-results', '<h4>ğŸ§ª Test d\'Authentification:</h4>');
            
            // VÃ©rifier l'Ã©tat d'authentification
            const isAuth = window.isAuthenticated;
            const currentUser = window.currentUser;
            
            addResult('functionality-results', `Ã‰tat d'authentification: ${isAuth ? 'ConnectÃ©' : 'Non connectÃ©'}`);
            addResult('functionality-results', `Utilisateur: ${currentUser ? 'DÃ©fini' : 'Non dÃ©fini'}`);
            
            // VÃ©rifier l'interface
            const homepage = document.getElementById('homepage-container');
            const authContainer = document.getElementById('auth-container');
            const mainInterface = document.getElementById('main-interface');
            
            addResult('functionality-results', `Page d'accueil: ${homepage ? (homepage.style.display !== 'none' ? 'Visible' : 'CachÃ©e') : 'Non trouvÃ©e'}`);
            addResult('functionality-results', `Container auth: ${authContainer ? (authContainer.style.display !== 'none' ? 'Visible' : 'CachÃ©e') : 'Non trouvÃ©'}`);
            addResult('functionality-results', `Interface principale: ${mainInterface ? (mainInterface.style.display !== 'none' ? 'Visible' : 'CachÃ©e') : 'Non trouvÃ©e'}`);
            
            log('âœ… Test authentification terminÃ©', 'success');
        }
        
        function generateCompleteReport() {
            log('ğŸ“‹ GÃ©nÃ©ration du rapport complet...', 'info');
            
            addResult('report-results', '<h4>ğŸ“‹ Rapport Complet:</h4>');
            
            // RÃ©sumÃ© des analyses
            addResult('report-results', '<h5>ğŸ“Š RÃ©sumÃ© des Analyses:</h5>');
            
            // Compter les problÃ¨mes
            const navButtons = document.querySelectorAll('.nav-btn');
            const criticalElements = ['homepage-container', 'auth-container', 'main-interface'];
            const missingElements = criticalElements.filter(id => !document.getElementById(id));
            const missingFunctions = ['initializeApp', 'switchPage', 'loadData'].filter(func => typeof window[func] !== 'function');
            
            addResult('report-results', `Boutons de navigation: ${navButtons.length}`);
            addResult('report-results', `Ã‰lÃ©ments critiques manquants: ${missingElements.length}`);
            addResult('report-results', `Fonctions manquantes: ${missingFunctions.length}`);
            
            // Recommandations
            addResult('report-results', '<h5>ğŸ’¡ Recommandations:</h5>');
            
            if (missingElements.length > 0) {
                addResult('report-results', 'âŒ Ã‰lÃ©ments DOM critiques manquants - VÃ©rifier la structure HTML');
            }
            
            if (missingFunctions.length > 0) {
                addResult('report-results', 'âŒ Fonctions JavaScript manquantes - VÃ©rifier le chargement des scripts');
            }
            
            if (navButtons.length === 0) {
                addResult('report-results', 'âŒ Aucun bouton de navigation trouvÃ© - VÃ©rifier la structure HTML');
            }
            
            if (missingElements.length === 0 && missingFunctions.length === 0 && navButtons.length > 0) {
                addResult('report-results', 'âœ… Structure de base correcte - ProblÃ¨me probablement dans la logique');
            }
            
            log('âœ… Rapport complet gÃ©nÃ©rÃ©', 'success');
        }
        
        function exportAnalysis() {
            log('ğŸ“¤ Export de l\'analyse...', 'info');
            
            const analysisData = {
                timestamp: new Date().toISOString(),
                domElements: {
                    homepage: !!document.getElementById('homepage-container'),
                    auth: !!document.getElementById('auth-container'),
                    main: !!document.getElementById('main-interface'),
                    navButtons: document.querySelectorAll('.nav-btn').length
                },
                functions: {
                    initializeApp: typeof window.initializeApp === 'function',
                    switchPage: typeof window.switchPage === 'function',
                    loadData: typeof window.loadData === 'function'
                },
                authentication: {
                    isAuthenticated: window.isAuthenticated,
                    currentUser: !!window.currentUser,
                    supabaseConfigured: window.isSupabaseConfigured
                }
            };
            
            const dataStr = JSON.stringify(analysisData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'analysis-report.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            URL.revokeObjectURL(url);
            
            log('âœ… Analyse exportÃ©e', 'success');
        }
        
        // Auto-analyse au chargement
        window.addEventListener('load', () => {
            setTimeout(() => {
                analyzeCriticalIssues();
                analyzeDOMStructure();
                analyzeJavaScript();
                analyzeAuthentication();
                analyzeData();
            }, 1000);
        });
    </script>
</body>
</html>
