<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🧪 Test des Corrections</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .status { padding: 15px; margin: 15px 0; border-radius: 5px; font-weight: bold; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button { background: #007bff; color: white; border: none; padding: 15px 30px; border-radius: 5px; cursor: pointer; margin: 10px; font-size: 16px; }
        button:hover { background: #0056b3; }
        button.success { background: #28a745; }
        button.success:hover { background: #218838; }
        .data-item { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 3px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧪 Test des Corrections</h1>
        
        <div id="status" class="status info">
            Test des corrections appliquées...
        </div>
        
        <div class="test-section">
            <h3>🔧 Corrections Appliquées</h3>
            <ul>
                <li>✅ Erreur de syntaxe 'savedUser' corrigée</li>
                <li>✅ Éléments keywordInput dupliqués corrigés</li>
                <li>✅ Fonctions showAuthForm et showDemo ajoutées</li>
            </ul>
        </div>
        
        <div class="test-section">
            <h3>🧪 Tests de Validation</h3>
            <button onclick="testMainApp()" class="success">🧪 Tester Application Principale</button>
            <button onclick="testFunctions()">🔧 Tester Fonctions</button>
            <button onclick="testElements()">🏗️ Tester Éléments DOM</button>
            <div id="test-results"></div>
        </div>
        
        <div class="test-section">
            <h3>🚀 Actions</h3>
            <button onclick="goToMainApp()" class="success">🏠 Aller à l'App</button>
            <button onclick="clearCache()">🗑️ Vider le Cache</button>
            <div id="action-results"></div>
        </div>
        
        <div id="results" style="margin-top: 20px;"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
        }
        
        function addResult(containerId, message) {
            const container = document.getElementById(containerId);
            const item = document.createElement('div');
            item.className = 'data-item';
            item.innerHTML = message;
            container.appendChild(item);
        }
        
        function testMainApp() {
            log('🧪 Test de l\'application principale...', 'info');
            
            addResult('test-results', '<h4>🧪 Test Application:</h4>');
            
            try {
                // Test de redirection vers l'app principale
                window.location.href = 'index.html';
                addResult('test-results', '✅ Redirection vers l\'app principale');
                
            } catch (error) {
                addResult('test-results', `❌ Erreur: ${error.message}`);
                log('❌ Erreur test application', 'error');
            }
        }
        
        function testFunctions() {
            log('🔧 Test des fonctions...', 'info');
            
            addResult('test-results', '<h4>🔧 Test Fonctions:</h4>');
            
            // Vérifier les fonctions critiques
            const functions = [
                'showAuthForm',
                'showDemo',
                'showHomepage',
                'initializeApp',
                'switchPage',
                'loadData'
            ];
            
            functions.forEach(func => {
                const exists = typeof window[func] === 'function';
                addResult('test-results', `${func}: ${exists ? '✅' : '❌'}`);
            });
            
            // Test des fonctions ajoutées
            if (typeof showAuthForm === 'function') {
                addResult('test-results', '✅ showAuthForm disponible');
            } else {
                addResult('test-results', '❌ showAuthForm manquante');
            }
            
            if (typeof showDemo === 'function') {
                addResult('test-results', '✅ showDemo disponible');
            } else {
                addResult('test-results', '❌ showDemo manquante');
            }
            
            log('✅ Test fonctions terminé', 'success');
        }
        
        function testElements() {
            log('🏗️ Test des éléments DOM...', 'info');
            
            addResult('test-results', '<h4>🏗️ Test Éléments DOM:</h4>');
            
            // Vérifier les éléments critiques
            const elements = [
                'homepage-container',
                'auth-container',
                'main-app'
            ];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    addResult('test-results', `✅ ${id} trouvé`);
                } else {
                    addResult('test-results', `❌ ${id} manquant`);
                }
            });
            
            // Vérifier les éléments keywordInput
            const keywordInputs = document.querySelectorAll('#keywordInput');
            const projectKeywordInputs = document.querySelectorAll('#projectKeywordInput');
            
            addResult('test-results', `keywordInput: ${keywordInputs.length} (attendu: 1)`);
            addResult('test-results', `projectKeywordInput: ${projectKeywordInputs.length} (attendu: 1)`);
            
            if (keywordInputs.length === 1 && projectKeywordInputs.length === 1) {
                addResult('test-results', '✅ Éléments keywordInput corrigés');
            } else {
                addResult('test-results', '❌ Problème avec les éléments keywordInput');
            }
            
            log('✅ Test éléments terminé', 'success');
        }
        
        function goToMainApp() {
            window.location.href = 'index.html';
        }
        
        function clearCache() {
            log('🗑️ Vidage du cache...', 'info');
            
            try {
                // Vider le cache
                localStorage.clear();
                sessionStorage.clear();
                
                // Réinitialiser les variables
                if (typeof window !== 'undefined') {
                    window.isAuthenticated = false;
                    window.currentUser = null;
                    window.db = null;
                    window.isSupabaseConfigured = false;
                }
                
                addResult('action-results', '✅ Cache vidé');
                addResult('action-results', '✅ Variables réinitialisées');
                
                // Recharger la page
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
                
                log('✅ Cache vidé', 'success');
                
            } catch (error) {
                addResult('action-results', `❌ Erreur: ${error.message}`);
                log('❌ Erreur vidage cache', 'error');
            }
        }
        
        // Auto-test au chargement
        window.addEventListener('load', () => {
            setTimeout(() => {
                testFunctions();
                testElements();
            }, 1000);
        });
    </script>
</body>
</html>
